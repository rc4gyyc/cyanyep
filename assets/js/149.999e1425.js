(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{520:function(v,_,l){"use strict";l.r(_);var t=l(1),i=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("在昨天的练习作业中，我们改造了余额支付功能，在支付成功后利用RabbitMQ通知交易服务，更新业务订单状态为已支付。")]),v._v(" "),_("p",[v._v("但是大家思考一下，如果这里MQ通知失败，支付服务中支付流水显示支付成功，而交易服务中的订单状态却显示未支付，数据出现了不一致。")]),v._v(" "),_("p",[v._v("此时前端发送请求查询支付状态时，肯定是查询交易服务状态，会发现业务订单未支付，而用户自己知道已经支付成功，这就导致用户体验不一致。")]),v._v(" "),_("p",[v._v("因此，这里我们必须尽可能确保MQ消息的可靠性，即：消息应该至少被消费者处理1次")]),v._v(" "),_("p",[v._v("那么问题来了：")]),v._v(" "),_("ul",[_("li",[_("strong",[v._v("我们该如何确保MQ消息的可靠性")]),v._v("？")]),v._v(" "),_("li",[_("strong",[v._v("如果真的发送失败，有没有其它的兜底方案？")])])]),v._v(" "),_("p",[v._v("这些问题，在今天的学习中都会找到答案。")]),v._v(" "),_("h2",{attrs:{id:"消息的可靠性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#消息的可靠性"}},[v._v("#")]),v._v(" 消息的可靠性")]),v._v(" "),_("p",[v._v("首先，我们一起分析一下消息丢失的可能性有哪些。")]),v._v(" "),_("p",[v._v("消息从发送者发送消息，到消费者处理消息，需要经过的流程是这样的：")]),v._v(" "),_("p",[_("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5Cimage-20250505193055934.png",alt:"image-20250505193055934"}})]),v._v(" "),_("p",[v._v("消息从生产者到消费者的每一步都可能导致消息丢失：")]),v._v(" "),_("ul",[_("li",[v._v("发送消息时丢失：\n"),_("ul",[_("li",[v._v("生产者发送消息时连接MQ失败")]),v._v(" "),_("li",[v._v("生产者发送消息到达MQ后未找到"),_("code",[v._v("Exchange")])]),v._v(" "),_("li",[v._v("生产者发送消息到达MQ的"),_("code",[v._v("Exchange")]),v._v("后，未找到合适的"),_("code",[v._v("Queue")])]),v._v(" "),_("li",[v._v("消息到达MQ后，处理消息的进程发生异常")])])]),v._v(" "),_("li",[v._v("MQ导致消息丢失：\n"),_("ul",[_("li",[v._v("消息到达MQ，保存到队列后，尚未消费就突然宕机")])])]),v._v(" "),_("li",[v._v("消费者处理消息时：\n"),_("ul",[_("li",[v._v("消息接收后尚未处理突然宕机")]),v._v(" "),_("li",[v._v("消息接收后处理过程中抛出异常")])])])]),v._v(" "),_("p",[v._v("综上，我们要解决消息丢失问题，保证MQ的可靠性，就必须从3个方面入手：")]),v._v(" "),_("ul",[_("li",[v._v("确保生产者一定把消息发送到MQ")]),v._v(" "),_("li",[v._v("确保MQ不会将消息弄丢")]),v._v(" "),_("li",[v._v("确保消费者一定要处理消息")])]),v._v(" "),_("p",[v._v("这一章我们先来看如何确保生产者一定能把消息发送到MQ。")])])}),[],!1,null,null,null);_.default=i.exports}}]);