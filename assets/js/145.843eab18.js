(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{516:function(v,a,t){"use strict";t.r(a);var _=t(1),s=Object(_.a)({},(function(){var v=this,a=v._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("p",[v._v("RabbitMQ是基于Erlang语言开发的开源消息通信中间件，官网地址：")]),v._v(" "),a("p",[v._v("https://www.rabbitmq.com/")]),v._v(" "),a("p",[v._v("接下来，我们就学习它的基本概念和基础用法。")]),v._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[v._v("#")]),v._v(" 安装")]),v._v(" "),a("p",[v._v("我们同样基于Docker来安装RabbitMQ，使用下面的命令即可：")]),v._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[v._v("docker")]),v._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-e")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[v._v("RABBITMQ_DEFAULT_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),v._v("itheima "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-e")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[v._v("RABBITMQ_DEFAULT_PASS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[v._v("123321")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-v")]),v._v(" mq-plugins:/plugins "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("--name")]),v._v(" mq "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("--hostname")]),v._v(" mq "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-p")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[v._v("15672")]),v._v(":15672 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-p")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[v._v("5672")]),v._v(":5672 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("--network")]),v._v(" hm-net"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[v._v("-d")]),v._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[v._v("\\")]),v._v("\n rabbitmq:3.8-management\n")])])]),a("p",[v._v("可以看到在安装命令中有两个映射的端口：")]),v._v(" "),a("ul",[a("li",[v._v("15672：RabbitMQ提供的管理控制台的端口")]),v._v(" "),a("li",[v._v("5672：RabbitMQ的消息发送处理接口")])]),v._v(" "),a("p",[v._v("安装完成后，我们访问 http://192.168.150.101:15672即可看到管理控制台。首次访问需要登录，默认的用户名和密码在配置文件中已经指定了。")]),v._v(" "),a("p",[v._v("登录后即可看到管理控制台总览页面：")]),v._v(" "),a("p",[v._v("RabbitMQ对应的架构如图：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746436714557-1.png",alt:"img"}})]),v._v(" "),a("p",[v._v("其中包含几个概念：")]),v._v(" "),a("ul",[a("li",[a("strong",[a("code",[v._v("publisher")])]),v._v("：生产者，也就是发送消息的一方")]),v._v(" "),a("li",[a("strong",[a("code",[v._v("consumer")])]),v._v("：消费者，也就是消费消息的一方")]),v._v(" "),a("li",[a("strong",[a("code",[v._v("queue")])]),v._v("：队列，存储消息。生产者投递的消息会暂存在消息队列中，等待消费者处理")]),v._v(" "),a("li",[a("strong",[a("code",[v._v("exchange")])]),v._v("：交换机，负责消息路由。生产者发送的消息由交换机决定投递到哪个队列。")]),v._v(" "),a("li",[a("strong",[a("code",[v._v("virtual host")])]),v._v("：虚拟主机，起到数据隔离的作用。每个虚拟主机相互独立，有各自的exchange、queue")])]),v._v(" "),a("p",[v._v("上述这些东西都可以在RabbitMQ的管理控制台来管理，下一节我们就一起来学习控制台的使用。")]),v._v(" "),a("h2",{attrs:{id:"收发消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#收发消息"}},[v._v("#")]),v._v(" 收发消息")]),v._v(" "),a("h3",{attrs:{id:"交换机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#交换机"}},[v._v("#")]),v._v(" 交换机")]),v._v(" "),a("p",[v._v("我们打开Exchanges选项卡，可以看到已经存在很多交换机：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746437087930-4.png",alt:"img"}})]),v._v(" "),a("p",[v._v("我们点击任意交换机，即可进入交换机详情页面。仍然会利用控制台中的publish message 发送一条消息：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746437123340-7.png",alt:"img"}})]),v._v(" "),a("p",[v._v("这里是由控制台模拟了生产者发送的消息。由于没有消费者存在，最终消息丢失了，这样说明"),a("strong",[v._v("交换机没有存储消息的能力")]),v._v("。")]),v._v(" "),a("h3",{attrs:{id:"队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#队列"}},[v._v("#")]),v._v(" 队列")]),v._v(" "),a("p",[v._v("我们打开"),a("code",[v._v("Queues")]),v._v("选项卡，新建一个队列：")]),v._v(" "),a("p",[v._v("命名为"),a("code",[v._v("hello.queue1")]),v._v("：")]),v._v(" "),a("p",[v._v("再以相同的方式，创建一个队列，命名为"),a("code",[v._v("hello.queue2")])]),v._v(" "),a("p",[v._v("此时，我们再次向"),a("code",[v._v("amq.fanout")]),v._v("交换机发送一条消息。会发现消息依然没有到达队列！！")]),v._v(" "),a("p",[v._v("发送到交换机的消息，只会路由到与其绑定的队列，因此仅仅创建队列是不够的，我们还需要将其与交换机绑定。")]),v._v(" "),a("h3",{attrs:{id:"绑定关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定关系"}},[v._v("#")]),v._v(" 绑定关系")]),v._v(" "),a("p",[v._v("点击"),a("code",[v._v("Exchanges")]),v._v("选项卡，点击"),a("code",[v._v("amq.fanout")]),v._v("交换机，进入交换机详情页，然后点击"),a("code",[v._v("Bindings")]),v._v("菜单，在表单中填写要绑定的队列名称：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746437591414-10.png",alt:"img"}})]),v._v(" "),a("p",[v._v("相同的方式，将hello.queue2也绑定到改交换机。")]),v._v(" "),a("p",[v._v("最终，绑定结果如下：")]),v._v(" "),a("h3",{attrs:{id:"发送消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[v._v("#")]),v._v(" 发送消息")]),v._v(" "),a("p",[v._v("再次回到exchange页面，找到刚刚绑定的"),a("code",[v._v("amq.fanout")]),v._v("，点击进入详情页，再次发送一条消息：")]),v._v(" "),a("p",[v._v("回到"),a("code",[v._v("Queues")]),v._v("页面，可以发现"),a("code",[v._v("hello.queue")]),v._v("中已经有一条消息了：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746437952796-13.png",alt:"img"}})]),v._v(" "),a("p",[v._v("点击队列名称，进入详情页，查看队列详情，这次我们点击get message：")]),v._v(" "),a("p",[v._v("可以看到消息到达队列了：")]),v._v(" "),a("p",[v._v("这个时候如果有消费者监听了MQ的"),a("code",[v._v("hello.queue1")]),v._v("或"),a("code",[v._v("hello.queue2")]),v._v("队列，自然就能接收到消息了。")]),v._v(" "),a("h2",{attrs:{id:"数据隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据隔离"}},[v._v("#")]),v._v(" 数据隔离")]),v._v(" "),a("h3",{attrs:{id:"用户管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[v._v("#")]),v._v(" 用户管理")]),v._v(" "),a("p",[v._v("点击"),a("code",[v._v("Admin")]),v._v("选项卡，首先会看到RabbitMQ控制台的用户管理界面：")]),v._v(" "),a("p",[v._v("这里的用户都是RabbitMQ的管理或运维人员。目前只有安装RabbitMQ时添加的"),a("code",[v._v("itheima")]),v._v("这个用户。仔细观察用户表格中的字段，如下：")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("Name")]),v._v("："),a("code",[v._v("itheima")]),v._v("，也就是用户名")]),v._v(" "),a("li",[a("code",[v._v("Tags")]),v._v("："),a("code",[v._v("administrator")]),v._v("，说明"),a("code",[v._v("itheima")]),v._v("用户是超级管理员，拥有所有权限")]),v._v(" "),a("li",[a("code",[v._v("Can access virtual host")]),v._v("： "),a("code",[v._v("/")]),v._v("，可以访问的"),a("code",[v._v("virtual host")]),v._v("，这里的"),a("code",[v._v("/")]),v._v("是默认的"),a("code",[v._v("virtual host")])])]),v._v(" "),a("p",[v._v("对于小型企业而言，出于成本考虑，我们通常只会搭建一套MQ集群，公司内的多个不同项目同时使用。这个时候为了避免互相干扰， 我们会利用"),a("code",[v._v("virtual host")]),v._v("的隔离特性，将不同项目隔离。一般会做两件事情：")]),v._v(" "),a("ul",[a("li",[v._v("给每个项目创建独立的运维账号，将管理权限分离。")]),v._v(" "),a("li",[v._v("给每个项目创建不同的"),a("code",[v._v("virtual host")]),v._v("，将每个项目的数据隔离。")])]),v._v(" "),a("p",[v._v("比如，我们给黑马商城创建一个新的用户，命名为"),a("code",[v._v("hmall")]),v._v("：")]),v._v(" "),a("p",[v._v("你会发现此时hmall用户没有任何"),a("code",[v._v("virtual host")]),v._v("的访问权限：")]),v._v(" "),a("p",[v._v("接下来我们就来授权")]),v._v(" "),a("h3",{attrs:{id:"virtual-host"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-host"}},[v._v("#")]),v._v(" virtual host")]),v._v(" "),a("p",[v._v("我们先退出登录：")]),v._v(" "),a("p",[v._v("切换到刚刚创建的hmall用户登录，然后点击"),a("code",[v._v("Virtual Hosts")]),v._v("菜单，进入"),a("code",[v._v("virtual host")]),v._v("管理页：")]),v._v(" "),a("p",[v._v("可以看到目前只有一个默认的"),a("code",[v._v("virtual host")]),v._v("，名字为 "),a("code",[v._v("/")]),v._v("。")]),v._v(" "),a("p",[v._v("我们可以给黑马商城项目创建一个单独的"),a("code",[v._v("virtual host")]),v._v("，而不是使用默认的"),a("code",[v._v("/")]),v._v("。")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746438103959-19.png",alt:"img"}})]),v._v(" "),a("p",[v._v("创建完成后如图：")]),v._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C86157%5CDesktop%5Cblog-img%5Cimg%5C1746438095593-16.png",alt:"img"}})]),v._v(" "),a("p",[v._v("由于我们是登录"),a("code",[v._v("hmall")]),v._v("账户后创建的"),a("code",[v._v("virtual host")]),v._v("，因此回到"),a("code",[v._v("users")]),v._v("菜单，你会发现当前用户已经具备了对"),a("code",[v._v("/hmall")]),v._v("这个"),a("code",[v._v("virtual host")]),v._v("的访问权限了：")]),v._v(" "),a("p",[v._v("此时，点击页面右上角的"),a("code",[v._v("virtual host")]),v._v("下拉菜单，切换"),a("code",[v._v("virtual host")]),v._v("为 "),a("code",[v._v("/hmall")]),v._v("：")]),v._v(" "),a("p",[v._v("然后再次查看queues选项卡，会发现之前的队列已经看不到了：")]),v._v(" "),a("p",[v._v("这就是基于"),a("code",[v._v("virtual host")]),v._v("的隔离效果。")])])}),[],!1,null,null,null);a.default=s.exports}}]);