(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{504:function(t,a,s){"use strict";s.r(a);var e=s(2),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Ducker:https://b11et3un53m.feishu.cn/wiki/MWQIw4Zvhil0I5ktPHwcoqZdnec")]),t._v(" "),a("p",[t._v("Linux安装教程：https://b11et3un53m.feishu.cn/wiki/FJAnwOhpIihMkLkOKQocdWZ7nUc")]),t._v(" "),a("p",[t._v("docker安装教程：https://b11et3un53m.feishu.cn/wiki/Rfocw7ctXij2RBkShcucLZbrn2d")]),t._v(" "),a("h1",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),a("p",[t._v("我们即将进入微服务阶段学习，微服务项目动辄就是几十台、上百台服务需要部署，有些大型项目甚至达到数万台服务。而"),a("strong",[t._v("由于每台服务器的运行环境不同，你写好的安装流程、部署脚本并不一定在每个服务器都能正常运行")]),t._v("，经常会出错。这就给系统的部署运维带来了很多困难。")]),t._v(" "),a("p",[t._v("让Docker帮我们安装和部署软件")]),t._v(" "),a("h1",{attrs:{id:"docker安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker安装"}},[t._v("#")]),t._v(" Docker安装")]),t._v(" "),a("h2",{attrs:{id:"_1-卸载旧版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-卸载旧版"}},[t._v("#")]),t._v(" 1.卸载旧版")]),t._v(" "),a("p",[t._v("首先如果系统中已经存在旧的Docker，则先卸载：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum remove "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-client "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-client-latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-common "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-latest "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-latest-logrotate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-logrotate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-engine "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    docker-selinux \n")])])]),a("h2",{attrs:{id:"_2-配置docker的yum库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置docker的yum库"}},[t._v("#")]),t._v(" 2.配置Docker的yum库")]),t._v(" "),a("p",[t._v("首先要安装一个yum工具")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" yum-utils device-mapper-persistent-data lvm2\n")])])]),a("p",[t._v("安装成功后，执行命令，配置Docker的yum源（已更新为阿里云源）：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s+download.docker.com+mirrors.aliyun.com/docker-ce+'")]),t._v(" /etc/yum.repos.d/docker-ce.repo\n")])])]),a("p",[t._v("更新yum，建立缓存")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum makecache fast\n")])])]),a("h2",{attrs:{id:"_3-安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装docker"}},[t._v("#")]),t._v(" 3.安装Docker")]),t._v(" "),a("p",[t._v("最后，执行命令，安装Docker")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n")])])]),a("h2",{attrs:{id:"_4-启动和校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-启动和校验"}},[t._v("#")]),t._v(" 4.启动和校验")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动Docker")]),t._v("\nsystemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止Docker")]),t._v("\nsystemctl stop "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启")]),t._v("\nsystemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置开机自启")]),t._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行docker ps命令，如果不报错，说明安装启动成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以用docker image查看docker是否可以运行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" image\n")])])]),a("h2",{attrs:{id:"_5-配置镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置镜像加速"}},[t._v("#")]),t._v(" 5.配置镜像加速")]),t._v(" "),a("p",[t._v("镜像地址可能会变更，如果失效可以百度找最新的docker镜像。")]),t._v(" "),a("p",[t._v("配置镜像步骤如下：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" /etc/docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 复制内容")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'EOF\'\n{\n    "registry-mirrors": [\n        "http://hub-mirror.c.163.com",\n        "https://mirrors.tuna.tsinghua.edu.cn",\n        "http://mirrors.sohu.com",\n        "https://ustc-edu-cn.mirror.aliyuncs.com",\n        "https://ccr.ccs.tencentyun.com",\n        "https://docker.m.daocloud.io",\n        "https://docker.awsl9527.cn"\n    ]\n}\nEOF')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新加载配置")]),t._v("\nsystemctl daemon-reload\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启Docker")]),t._v("\nsystemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("\n")])])]),a("h1",{attrs:{id:"快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[t._v("#")]),t._v(" 快速入门")]),t._v(" "),a("h2",{attrs:{id:"_1-1-部署mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-部署mysql"}},[t._v("#")]),t._v(" 1.1.部署MySQL")]),t._v(" "),a("p",[t._v("首先，我们利用Docker来安装一个MySQL软件，大家可以对比一下之前传统的安装方式，看看哪个效率更高一些。")]),t._v(" "),a("p",[t._v("如果是利用传统方式部署MySQL，大概的步骤有：")]),t._v(" "),a("ul",[a("li",[t._v("搜索并下载MySQL安装包")]),t._v(" "),a("li",[t._v("上传至Linux环境")]),t._v(" "),a("li",[t._v("编译和配置环境")]),t._v(" "),a("li",[t._v("安装")])]),t._v(" "),a("p",[t._v("而使用Docker安装，仅仅需要一步即可，在命令行输入下面的命令（建议采用CV大法）：")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("docker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name mysql \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 3306:3306 \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e TZ=Asia/Shanghai \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e MYSQL_ROOT_PASSWORD=123 \\\n  mysql\n")])])]),a("p",[t._v("这种安装方式你完全不用考虑运行的操作系统环境，它不仅仅在CentOS系统是这样，在Ubuntu系统、macOS系统、甚至是装了WSL的Windows下，都可以使用这条命令来安装MySQL。")]),t._v(" "),a("p",[t._v("因为Docker会自动搜索并下载MySQL。注意：这里下载的不是安装包，而是"),a("strong",[t._v("镜像。"),a("strong",[t._v("镜像中不仅包含了MySQL本身，还包含了其运行所需要的环境、配置、系统级函数库。因此它在运行时就有自己独立的环境，就可以跨系统运行，也不需要手动再次配置环境了。这套独立运行的隔离环境我们称为")]),t._v("容器")]),t._v("。")]),t._v(" "),a("p",[t._v("说明：")]),t._v(" "),a("ul",[a("li",[t._v("镜像：英文是image")]),t._v(" "),a("li",[t._v("容器：英文是container")])]),t._v(" "),a("h2",{attrs:{id:"_1-2-命令解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-命令解读"}},[t._v("#")]),t._v(" 1.2.命令解读")]),t._v(" "),a("p",[t._v("利用Docker快速的安装了MySQL，非常的方便，不过我们执行的命令到底是什么意思呢？")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("docker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name mysql \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 3306:3306 \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e TZ=Asia/Shanghai \\\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e MYSQL_ROOT_PASSWORD=123 \\\n  mysql\n")])])]),a("blockquote",[a("p",[t._v("解读：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docker run -d")]),t._v(" ：创建并运行一个容器，"),a("code",[t._v("-d")]),t._v("则是让容器以后台进程运行")]),t._v(" "),a("li",[a("code",[t._v("--name`` mysql")]),t._v(" : 给容器起个名字叫"),a("code",[t._v("mysql")]),t._v("，你可以叫别的")]),t._v(" "),a("li",[a("code",[t._v("-p 3306:3306")]),t._v(" : 设置端口映射。\n"),a("ul",[a("li",[a("strong",[t._v("容器是隔离环境")]),t._v("，外界不可访问。但是可以"),a("strong",[t._v("将"),a("strong",[a("strong",[t._v("宿主机")])]),t._v("端口****映射容器内到端口")]),t._v("，当访问宿主机指定端口时，就是在访问容器内的端口了。")]),t._v(" "),a("li",[t._v("容器内端口往往是由容器内的进程决定，例如MySQL进程默认端口是3306，因此容器内端口一定是3306；而宿主机端口则可以任意指定，一般与容器内保持一致。")]),t._v(" "),a("li",[t._v("格式： "),a("code",[t._v("-p 宿主机端口:容器内端口")]),t._v("，示例中就是将宿主机的3306映射到容器内的3306端口")])])]),t._v(" "),a("li",[a("code",[t._v("-``e`` TZ=Asia/Shanghai")]),t._v(" : 配置容器内进程运行时的一些参数\n"),a("ul",[a("li",[t._v("格式："),a("code",[t._v("-e KEY=VALUE")]),t._v("，KEY和VALUE都由容器内进程决定")]),t._v(" "),a("li",[t._v("案例中，"),a("code",[t._v("TZ``=Asia/Shanghai")]),t._v("是设置时区；"),a("code",[t._v("MYSQL_ROOT_PASSWORD=123")]),t._v("是设置MySQL默认密码")])])]),t._v(" "),a("li",[a("code",[t._v("mysql")]),t._v(" : 设置"),a("strong",[t._v("镜像")]),t._v("名称，Docker会根据这个名字搜索并下载镜像\n"),a("ul",[a("li",[t._v("格式："),a("code",[t._v("REPOSITORY:TAG")]),t._v("，例如"),a("code",[t._v("mysql:8.0")]),t._v("，其中"),a("code",[t._v("REPOSITORY")]),t._v("可以理解为镜像名，"),a("code",[t._v("TAG")]),t._v("是版本号")]),t._v(" "),a("li",[t._v("在未指定"),a("code",[t._v("TAG")]),t._v("的情况下，默认是最新版本，也就是"),a("code",[t._v("mysql:latest")])])])])])]),t._v(" "),a("p",[t._v("镜像的名称不是随意的，而是要到DockerRegistry中寻找，镜像运行时的配置也不是随意的，要参考镜像的帮助文档，这些在DockerHub网站或者软件的官方网站中都能找到。")]),t._v(" "),a("p",[t._v("如果我们要安装其它软件，也可以到DockerRegistry中寻找对应的镜像名称和版本，阅读相关配置即可。")]),t._v(" "),a("h1",{attrs:{id:"_2-docker基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker基础"}},[t._v("#")]),t._v(" 2.Docker基础")]),t._v(" "),a("p",[t._v("接下来，我们一起来学习Docker使用的一些基础知识，为将来部署项目打下基础。具体用法可以参考Docker官方文档：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/")]),t._v(" "),a("h2",{attrs:{id:"_2-1-常见命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-常见命令"}},[t._v("#")]),t._v(" 2.1.常见命令")]),t._v(" "),a("p",[t._v("首先我们来学习Docker中的常见命令，可以参考官方文档：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/engine/reference/commandline/cli/")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.bilibili.com/video/BV1HP4118797?spm_id_from=333.788.videopod.episodes&vd_source=5063386180163934afae66c4e87325ac&p=5",target:"_blank",rel:"noopener noreferrer"}},[t._v("黑马视频"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_2-1-1-命令介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-命令介绍"}},[t._v("#")]),t._v(" 2.1.1.命令介绍")]),t._v(" "),a("p",[t._v("其中，比较常见的命令有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("命令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("文档地址")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker pull")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("拉取镜像")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/pull/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker pull"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker push")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("推送镜像到DockerRegistry")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/push/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker push"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker images")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看本地镜像")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/images/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker images"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker rmi")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除本地镜像")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rmi/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker rmi"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker run")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建并运行容器（不能重复创建）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker run"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker stop")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("停止指定容器")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stop/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker stop"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker start")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("启动指定容器")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/start/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker start"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker restart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("重新启动容器")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/restart/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker restart"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker rm")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定容器")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker ps")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/ps/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker ps"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker logs (-f)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器运行日志(持续跟踪)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/logs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker logs"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker exec  (-it)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("进入容器 (以可交互的终端)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/exec/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker exec"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker save")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("保存镜像到本地压缩文件")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/save/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker save"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker load")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("加载本地压缩文件到镜像")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/load/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker load"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker inspect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器详细信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker inspect"),a("OutboundLink")],1)])])])]),t._v(" "),a("p",[t._v("用一副图来表示这些命令的关系：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/image-20250120205332454.png",alt:"image-20250120205332454"}})]),t._v(" "),a("p",[t._v("补充：")]),t._v(" "),a("p",[t._v("默认情况下，每次重启虚拟机我们都需要手动启动Docker和Docker中的容器。通过命令可以实现开机自启：")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker开机自启")]),t._v("\nsystemctl enable docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker容器开机自启")]),t._v("\ndocker update "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("restart=always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("容器名"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("容器id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-1-2-演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-演示"}},[t._v("#")]),t._v(" 2.1.2.演示")]),t._v(" "),a("p",[t._v("教学环节说明：我们以Nginx为例给大家演示上述命令。")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第1步，去DockerHub查看nginx镜像仓库及相关信息")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第2步，拉取Nginx镜像")]),t._v("\ndocker pull nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第3步，查看镜像")]),t._v("\ndocker images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果如下：")]),t._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nnginx        latest    605c77e624dd   16 months ago   141MB\nmysql        latest    3218b38490ce   17 months ago   516MB\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第4步，创建并允许Nginx容器")]),t._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 80:80 nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第5步，查看运行中容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以加格式化方式访问，格式会更加清爽")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第6步，访问网页，地址：http://虚拟机地址")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第7步，停止容器")]),t._v("\ndocker stop nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第8步，查看所有容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第9步，再次启动nginx容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第10步，再次查看容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第11步，查看容器详细信息")]),t._v("\ndocker inspect nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第12步，进入容器,查看容器内目录")]),t._v("\ndocker exec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it nginx bash\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者，可以进入MySQL")]),t._v("\ndocker exec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it mysql mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("uroot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第13步，删除容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发现无法删除，因为容器运行中，强制删除容器")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f nginx\n")])])]),a("h3",{attrs:{id:"_2-1-3-命令别名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-命令别名"}},[t._v("#")]),t._v(" 2.1.3.命令别名")]),t._v(" "),a("p",[t._v("给常用Docker命令起别名，方便我们访问：")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改/root/.bashrc文件")]),t._v("\nvi "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bashrc\n内容如下：\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .bashrc")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# User specific aliases and functions")]),t._v("\n\nalias "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v("="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rm -i'")]),t._v("\nalias "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v("="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cp -i'")]),t._v("\nalias "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v("="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mv -i'")]),t._v("\nalias dps="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'docker ps --format \"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}\"'")]),t._v("\nalias dis="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'docker images'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Source global definitions")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/bashrc "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" then\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/bashrc\nfi\n")])])]),a("p",[t._v("然后，执行命令使别名生效")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("source "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bashrc\n")])])]),a("h2",{attrs:{id:"_2-2-数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-数据卷"}},[t._v("#")]),t._v(" 2.2.数据卷")]),t._v(" "),a("p",[t._v("容器是隔离环境，容器内程序的文件、配置、运行时产生的容器都在容器内部，我们要读写容器内的文件非常不方便。大家思考几个问题：")]),t._v(" "),a("ul",[a("li",[t._v("如果要升级MySQL版本，需要销毁旧容器，那么数据岂不是跟着被销毁了？")]),t._v(" "),a("li",[t._v("MySQL、Nginx容器运行后，如果我要修改其中的某些配置该怎么办？")]),t._v(" "),a("li",[t._v("我想要让Nginx代理我的静态资源怎么办？")])]),t._v(" "),a("p",[t._v("因此，容器提供程序的运行环境，但是"),a("strong",[t._v("程序运行产生的数据、程序运行依赖的配置都应该与容器解耦")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_2-2-1-什么是数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-什么是数据卷"}},[t._v("#")]),t._v(" 2.2.1.什么是数据卷")]),t._v(" "),a("p",[a("strong",[t._v("数据卷（volume）"),a("strong",[t._v("是一个虚拟目录，是")]),t._v("容器内目录")]),t._v("与"),a("strong",[t._v("宿主机目录")]),t._v("之间映射的桥梁。")]),t._v(" "),a("p",[t._v("以Nginx为例，我们知道Nginx中有两个关键的目录：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("html")]),t._v("：放置一些静态资源")]),t._v(" "),a("li",[a("code",[t._v("conf")]),t._v("：放置配置文件")])]),t._v(" "),a("p",[t._v("如果我们要让Nginx代理我们的静态资源，最好是放到"),a("code",[t._v("html")]),t._v("目录；如果我们要修改Nginx的配置，最好是找到"),a("code",[t._v("conf")]),t._v("下的"),a("code",[t._v("nginx.conf")]),t._v("文件。")]),t._v(" "),a("p",[t._v("但遗憾的是，容器运行的Nginx所有的文件都在容器内部。所以我们必须利用数据卷将两个目录与宿主机目录关联，方便我们操作。如图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/image-20250120211232023.png",alt:"image-20250120211232023"}})]),t._v(" "),a("p",[t._v("在上图中：")]),t._v(" "),a("ul",[a("li",[t._v("我们创建了两个数据卷："),a("code",[t._v("conf")]),t._v("、"),a("code",[t._v("html")])]),t._v(" "),a("li",[t._v("Nginx容器内部的"),a("code",[t._v("conf")]),t._v("目录和"),a("code",[t._v("html")]),t._v("目录分别与两个数据卷关联。")]),t._v(" "),a("li",[t._v("而数据卷conf和html分别指向了宿主机的"),a("code",[t._v("/var/lib/docker/volumes/conf/_data")]),t._v("目录和"),a("code",[t._v("/var/lib/docker/volumes/html/_data")]),t._v("目录")])]),t._v(" "),a("p",[t._v("这样以来，容器内的"),a("code",[t._v("conf")]),t._v("和"),a("code",[t._v("html")]),t._v("目录就 与宿主机的"),a("code",[t._v("conf")]),t._v("和"),a("code",[t._v("html")]),t._v("目录关联起来，我们称为"),a("strong",[t._v("挂载")]),t._v("。此时，我们操作宿主机的"),a("code",[t._v("/var/lib/docker/volumes/html/_data")]),t._v("就是在操作容器内的"),a("code",[t._v("/usr/share/nginx/html/_data")]),t._v("目录。只要我们将静态资源放入宿主机对应目录，就可以被Nginx代理了。")]),t._v(" "),a("p",[a("strong",[t._v("小提示")]),t._v("：")]),t._v(" "),a("p",[a("code",[t._v("/var/lib/docker/volumes")]),t._v("这个目录就是默认的存放所有容器数据卷的目录，其下再根据数据卷名称创建新目录，格式为"),a("code",[t._v("/数据卷名/_data")]),t._v("。")]),t._v(" "),a("p",[a("strong",[t._v("为什么不让容器目录直接指向宿主机目录呢")]),t._v("？")]),t._v(" "),a("ul",[a("li",[t._v("因为直接指向宿主机目录就与宿主机强耦合了，如果切换了环境，宿主机目录就可能发生改变了。由于容器一旦创建，目录挂载就无法修改，这样容器就无法正常工作了。")]),t._v(" "),a("li",[t._v("但是容器指向数据卷，一个逻辑名称，而数据卷再指向宿主机目录，就不存在强耦合。如果宿主机目录发生改变，只要改变数据卷与宿主机目录之间的映射关系即可。")])]),t._v(" "),a("p",[t._v("不过，我们通过由于数据卷目录比较深，不好寻找，通常我们也"),a("strong",[t._v("允许让容器直接与"),a("strong",[a("strong",[t._v("宿主机")])]),t._v("目录挂载而不使用数据卷")]),t._v("，具体参考2.2.3小节。")]),t._v(" "),a("h3",{attrs:{id:"_2-2-2-数据卷命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-数据卷命令"}},[t._v("#")]),t._v(" 2.2.2.数据卷命令")]),t._v(" "),a("p",[t._v("数据卷的相关命令有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("命令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("文档地址")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume create")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建数据卷")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_create/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker volume create"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume ls")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看所有数据卷")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_ls/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume rm")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定数据卷")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume inspect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看某个数据卷的详情")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume prune")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("清除数据卷")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker volume prune"),a("OutboundLink")],1)])])])]),t._v(" "),a("p",[t._v("注意：容器与数据卷的挂载要在创建容器时配置，对于创建好的容器，是不能设置数据卷的。而且"),a("strong",[t._v("创建容器的过程中，数据卷会自动创建")]),t._v("。")]),t._v(" "),a("p",[t._v("教学"),a("strong",[t._v("演示环节")]),t._v("：演示一下nginx的html目录挂载")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.首先创建容器并指定数据卷，注意通过 -v 参数来指定数据卷")]),t._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 80:80 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v html:"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/share/nginx/html nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后查看数据卷")]),t._v("\ndocker volume "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nDRIVER    VOLUME NAME\nlocal     29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f\nlocal     html\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.查看数据卷详情")]),t._v("\ndocker volume inspect html\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CreatedAt"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2024-05-17T19:57:08+08:00"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Driver"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Labels"')]),t._v(": null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mountpoint"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/html/_data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Options"')]),t._v(": null"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Scope"')]),t._v(": "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.查看/var/lib/docker/volumes/html/_data目录")]),t._v("\nll "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib/docker/volumes/html/_data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到与nginx的html目录内容一样，结果如下：")]),t._v("\n总用量 8\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 1 root root 497 12月 28 2021 50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 1 root root 615 12月 28 2021 index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.进入该目录，并随意修改index.html内容")]),t._v("\ncd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib/docker/volumes/html/_data\nvi index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.打开页面，查看效果")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.进入容器内部，查看/usr/share/nginx/html目录内的文件是否变化")]),t._v("\ndocker exec "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it nginx bash\n")])])]),a("p",[t._v("教学"),a("strong",[t._v("演示环节")]),t._v("：演示一下MySQL的匿名数据卷")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.查看MySQL容器详细信息")]),t._v("\ndocker inspect mysql\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关注其中.Config.Volumes部分和.Mounts部分")]),t._v("\n")])])]),a("p",[t._v("我们关注两部分内容，第一是"),a("code",[t._v(".Config.Volumes")]),t._v("部分：")]),t._v(" "),a("div",{staticClass:"language-JSON extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Config"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 略")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Volumes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"/var/lib/mysql"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 略")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可以发现这个容器声明了一个本地目录，需要挂载数据卷，但是"),a("strong",[t._v("数据卷未定义")]),t._v("。这就是"),a("strong",[t._v("匿名卷")]),t._v("。")]),t._v(" "),a("p",[t._v("然后，我们再看结果中的"),a("code",[t._v(".Mounts")]),t._v("部分：")]),t._v(" "),a("div",{staticClass:"language-JSON extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"volume"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/mysql"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可以发现，其中有几个关键属性：")]),t._v(" "),a("ul",[a("li",[t._v("Name：数据卷名称。由于定义容器未设置容器名，这里的就是匿名卷自动生成的名字，一串hash值。")]),t._v(" "),a("li",[t._v("Source：宿主机目录")]),t._v(" "),a("li",[t._v("Destination : 容器内的目录")])]),t._v(" "),a("p",[t._v("上述配置是将容器内的"),a("code",[t._v("/var/lib/mysql")]),t._v("这个目录，与数据卷"),a("code",[t._v("29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f")]),t._v("挂载。于是在宿主机中就有了"),a("code",[t._v("/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data")]),t._v("这个目录。这就是匿名数据卷对应的目录，其使用方式与普通数据卷没有差别。")]),t._v(" "),a("p",[t._v("接下来，可以查看该目录下的MySQL的data文件：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" /var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data\n")])])]),a("p",[t._v("注意："),a("strong",[t._v("每一个不同的镜像，将来创建容器后内部有哪些目录可以挂载")]),t._v("，可以参考DockerHub对应的页面")]),t._v(" "),a("h3",{attrs:{id:"_2-2-3-挂载本地目录或文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-挂载本地目录或文件"}},[t._v("#")]),t._v(" 2.2.3.挂载本地目录或文件")]),t._v(" "),a("p",[t._v("可以发现，数据卷的目录结构较深，如果我们去操作数据卷目录会不太方便。在很多情况下，我们会"),a("strong",[t._v("直接将容器目录与宿主机指定目录挂载")]),t._v("。挂载语法与数据卷"),a("strong",[t._v("类似")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 挂载本地目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 本地目录:容器内目录\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 挂载本地文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 本地文件:容器内文件\n")])])]),a("p",[a("strong",[t._v("注意")]),t._v("："),a("strong",[t._v("本地目录或文件必须以 "),a("code",[t._v("/")]),t._v(" 或 "),a("code",[t._v("./")]),t._v("开头，如果直接以名字开头，会被识别为数据卷名而非本地目录名")]),t._v("。")]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" mysql:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会被识别为一个数据卷叫mysql，运行时会自动创建这个数据卷")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会被识别为当前目录下的mysql目录，运行时如果不存在会创建目录")]),t._v("\n")])])]),a("p",[a("strong",[t._v("教学演示")]),t._v("，删除并重新创建mysql容器，并完成本地目录挂载：")]),t._v(" "),a("ul",[a("li",[t._v("挂载"),a("code",[t._v("/root/mysql/data")]),t._v("到容器内的"),a("code",[t._v("/var/lib/mysql")]),t._v("目录")]),t._v(" "),a("li",[t._v("挂载"),a("code",[t._v("/root/mysql/init")]),t._v("到容器内的"),a("code",[t._v("/docker-entrypoint-initdb.d")]),t._v("目录（初始化的SQL脚本目录）")]),t._v(" "),a("li",[t._v("挂载"),a("code",[t._v("/root/mysql/conf")]),t._v("到容器内的"),a("code",[t._v("/etc/mysql/conf.d")]),t._v("目录（这个是MySQL配置文件目录）")])]),t._v(" "),a("p",[t._v("在课前资料中已经准备好了mysql的"),a("code",[t._v("init")]),t._v("目录和"),a("code",[t._v("conf")]),t._v("目录：")]),t._v(" "),a("p",[t._v("其中，hm.cnf主要是配置了MySQL的默认编码，改为utf8mb4；而hmall.sql则是后面我们要用到的黑马商城项目的初始化SQL脚本。")]),t._v(" "),a("p",[t._v("我们直接将整个mysql目录上传至虚拟机的"),a("code",[t._v("/root")]),t._v("目录下：")]),t._v(" "),a("p",[t._v("接下来，我们演示本地目录挂载：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.删除原来的MySQL容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.进入root目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.创建并运行新mysql容器，挂载本地目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/conf:/etc/mysql/conf.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/init:/docker-entrypoint-initdb.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.查看root目录，可以发现~/mysql/data目录已经自动创建好了")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root    root   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 conf\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" polkitd root "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 data\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root    root   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 init\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看data目录，会发现里面有大量数据库数据，说明数据库完成了初始化")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.查看MySQL容器内数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.1.进入MySQL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" mysql mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-uroot")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p123")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.2.查看编码表")]),t._v("\nshow variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%char%"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.3.结果，发现编码是utf8mb4没有问题")]),t._v("\n+--------------------------+--------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Variable_name            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Value                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+--------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_client     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_connection "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_database   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_filesystem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" binary                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_results    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_server     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_system     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb3                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_sets_dir       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" /usr/share/mysql-8.0/charsets/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+--------------------------------+\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.查看数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.1.查看数据库")]),t._v("\nshow databases"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果，hmall是黑马商城数据库")]),t._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Database           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" hmall              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" information_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mysql              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" performance_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" sys                "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.2.切换到hmall数据库")]),t._v("\nuse hmall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.3.查看表")]),t._v("\nshow tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Tables_in_hmall "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" address         "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" cart            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" item            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" order           "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" order_detail    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" order_logistics "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" pay_order       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" user            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+-----------------+\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.4.查看address表数据")]),t._v("\n+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" user_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" province "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" city   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" town     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mobile      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" street        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" contact   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" is_default "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" notes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 北京     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 北京   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 朝阳区    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13900112222")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 金燕龙办公楼   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 李佳诚    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 北京     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 北京   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 朝阳区    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13700221122")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 修正大厦       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 李佳红    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("61")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 上海     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 上海   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 浦东新区  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13301212233")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 航头镇航头路   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 李佳星    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("63")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 广东     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 佛山   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 永春      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13301212233")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 永春武馆       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 李晓龙    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" NULL  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+----+---------+----------+--------+----------+-------------+---------------+-----------+------------+-------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-3-镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-镜像"}},[t._v("#")]),t._v(" 2.3.镜像")]),t._v(" "),a("p",[t._v("前面我们一直在使用别人准备好的镜像，那如果我要部署一个Java项目，把它打包为一个镜像该怎么做呢？")]),t._v(" "),a("h3",{attrs:{id:"_2-3-1-镜像结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-镜像结构"}},[t._v("#")]),t._v(" 2.3.1.镜像结构")]),t._v(" "),a("p",[t._v("要想自己构建镜像，必须先了解镜像的结构。")]),t._v(" "),a("p",[t._v("之前我们说过，镜像之所以能让我们快速跨操作系统部署应用而忽略其运行环境、配置，就是因为镜像中包含了程序运行需要的系统函数库、环境、配置、依赖。")]),t._v(" "),a("p",[t._v("因此，自定义镜像本质就是依次准备好程序运行的基础环境、依赖、应用本身、运行配置等文件，并且打包而成。")]),t._v(" "),a("p",[t._v("举个例子，我们要从0部署一个Java应用，大概流程是这样：")]),t._v(" "),a("ul",[a("li",[t._v("准备一个linux服务（CentOS或者Ubuntu均可）")]),t._v(" "),a("li",[t._v("安装并配置JDK")]),t._v(" "),a("li",[t._v("上传Jar包")]),t._v(" "),a("li",[t._v("运行jar包")])]),t._v(" "),a("p",[t._v("那因此，我们打包镜像也是分成这么几步：")]),t._v(" "),a("ul",[a("li",[t._v("准备Linux运行环境（java项目并不需要完整的操作系统，仅仅是基础运行环境即可）")]),t._v(" "),a("li",[t._v("安装并配置JDK")]),t._v(" "),a("li",[t._v("拷贝jar包")]),t._v(" "),a("li",[t._v("配置启动脚本")])]),t._v(" "),a("p",[t._v("上述步骤中的每一次操作其实都是在生产一些文件（系统运行环境、函数库、配置最终都是磁盘文件），所以"),a("strong",[t._v("镜像就是一堆文件的集合")]),t._v("。")]),t._v(" "),a("p",[t._v("但需要注意的是，镜像文件不是随意堆放的，而是按照操作的步骤分层叠加而成，每一层形成的文件都会单独打包并标记一个唯一id，称为"),a("strong",[t._v("Layer")]),t._v("（"),a("strong",[t._v("层")]),t._v("）。这样，如果我们构建时用到的某些层其他人已经制作过，就可以直接拷贝使用这些层，而不用重复制作。")]),t._v(" "),a("p",[t._v("例如，第一步中需要的Linux运行环境，通用性就很强，所以Docker官方就制作了这样的只包含Linux运行环境的镜像。我们在制作java镜像时，就无需重复制作，直接使用Docker官方提供的CentOS或Ubuntu镜像作为基础镜像。然后再搭建其它层即可，这样逐层搭建，最终整个Java项目的镜像结构如图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/1737379994157-7.png",alt:"img"}})]),t._v(" "),a("h3",{attrs:{id:"_2-3-2-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-dockerfile"}},[t._v("#")]),t._v(" 2.3.2.Dockerfile")]),t._v(" "),a("p",[t._v("由于制作镜像的过程中，需要逐层处理和打包，比较复杂，所以Docker就提供了自动打包镜像的功能。我们只需要将打包的过程，每一层要做的事情用固定的语法写下来，交给Docker去执行即可。")]),t._v(" "),a("p",[t._v("而这种记录镜像结构的文件就称为"),a("strong",[t._v("Dockerfile")]),t._v("，其对应的语法可以参考官方文档：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/engine/reference/builder/")]),t._v(" "),a("p",[t._v("其中的语法比较多，比较常用的有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("指令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("示例")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("FROM")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定基础镜像")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("FROM centos:6")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("ENV")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("设置环境变量，可在后面指令使用")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("ENV key value")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("COPY")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("拷贝本地文件到镜像的指定目录")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("COPY ./xx.jar /tmp/app.jar")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("RUN")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("执行Linux的shell命令，一般是安装过程的命令")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("RUN yum install gcc")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("EXPOSE")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定容器运行时监听的端口，是给镜像使用者看的")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("EXPOSE 8080")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("ENTRYPOINT")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("镜像中应用的启动命令，容器运行时调用")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ENTRYPOINT java -jar xx.jar")])])])]),t._v(" "),a("p",[t._v("例如，要基于Ubuntu镜像来构建一个Java应用，其Dockerfile内容如下：")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定基础镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ubuntu:16.04")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置环境变量，JDK的安装目录、容器内时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" JAVA_DIR=/usr/local")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=Asia/Shanghai")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝jdk和java项目的包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./jdk8.tar.gz "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v("/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./docker-demo.jar /tmp/app.jar")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装JDK")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" cd "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n && tar -xf ./jdk8.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n && mv ./jdk1.8.0_144 ./java8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置环境变量")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" JAVA_HOME="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v("/java8")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" PATH="),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PATH")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/bin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定项目监听的端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 入口，java项目的启动命令")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),t._v("]")]),t._v("\n")])])]),a("p",[t._v("同学们思考一下：以后我们会有很多很多java项目需要打包为镜像，他们都需要Linux系统环境、JDK环境这两层，只有上面的3层不同（因为jar包不同）。如果每次制作java镜像都重复制作前两层镜像，是不是很麻烦。")]),t._v(" "),a("p",[t._v("所以，就"),a("strong",[t._v("有人提供了基础的系统加JDK环境")]),t._v("，我们在此基础上制作java镜像，就可以省去JDK的配置了：")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基础镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk:11.0-jre-buster")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定时区")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=Asia/Shanghai")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝jar包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" docker-demo.jar /app.jar")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 入口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),t._v("]")]),t._v("\n")])])]),a("p",[t._v("是不是简单多了。")]),t._v(" "),a("h3",{attrs:{id:"_2-3-3-构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-构建镜像"}},[t._v("#")]),t._v(" 2.3.3.构建镜像")]),t._v(" "),a("p",[t._v("当Dockerfile文件写好以后，就可以利用命令来构建镜像了。")]),t._v(" "),a("p",[t._v("在课前资料中，我们准备好了一个demo项目及对应的Dockerfile：")]),t._v(" "),a("p",[t._v("首先，我们将课前资料提供的"),a("code",[t._v("docker-demo.jar")]),t._v("包以及"),a("code",[t._v("Dockerfile")]),t._v("拷贝到虚拟机的"),a("code",[t._v("/root/demo")]),t._v("目录：")]),t._v(" "),a("p",[t._v("Dockerfile中使用了openjdk:11.0-jre-buster，可以在外部直接下载后指定为镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker load -i jdk.tar\n")])])]),a("p",[t._v("然后，执行命令，构建镜像：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入镜像目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/demo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始构建")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" docker-demo:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("命令说明：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docker build")]),t._v(": 就是构建一个docker镜像")]),t._v(" "),a("li",[a("code",[t._v("-t docker-demo:1.0")]),t._v(" ："),a("code",[t._v("-t")]),t._v("参数是指定镜像的名称（"),a("code",[t._v("repository")]),t._v("和"),a("code",[t._v("tag")]),t._v("）")]),t._v(" "),a("li",[a("code",[t._v(".")]),t._v(" : 最后的点是指构建时Dockerfile所在路径，由于我们进入了demo目录，所以指定的是"),a("code",[t._v(".")]),t._v("代表当前目录，也可以直接指定Dockerfile目录：\n"),a("ul",[a("li",[a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接指定Dockerfile目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" docker-demo:1.0 /root/demo\n")])])])])])])]),t._v(" "),a("p",[t._v("查看镜像列表：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看镜像列表：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\ndocker-demo   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("       d6ab0b9e64b9   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" minutes ago   327MB\nnginx         latest    605c77e624dd   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" months ago    141MB\nmysql         latest    3218b38490ce   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" months ago    516MB\n")])])]),a("p",[t._v("然后尝试运行该镜像：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.创建并运行容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 docker-demo:1.0\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.查看容器")]),t._v("\ndps\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nCONTAINER ID   IMAGE             PORTS                                                  STATUS         NAMES\n78a000447b49   docker-demo:1.0   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8080-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp, :::8090-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("/tcp              Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\nf63cfead8502   mysql             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, :::3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("33060")]),t._v("/tcp   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" hours     mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.访问")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" localhost:8080/hello/count\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("5")]),t._v(">")]),t._v("欢迎访问黑马商城, 这是您第1次访问"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("5")]),t._v(">")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-4-网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-网络"}},[t._v("#")]),t._v(" 2.4.网络")]),t._v(" "),a("p",[t._v("上节课我们创建了一个Java项目的容器，而Java项目往往需要访问其它各种中间件，例如MySQL、Redis等。现在，我们的容器之间能否互相访问呢？我们来测试一下")]),t._v(" "),a("p",[t._v("首先，我们查看下MySQL容器的详细信息，重点关注其中的网络IP地址：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.用基本命令，寻找Networks.bridge.IPAddress属性")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect mysql\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以使用format过滤结果")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{range .NetworkSettings.Networks}}{{println .IPAddress}}{{end}}'")]),t._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 得到IP地址如下：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后通过命令进入dd容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.在容器内，通过ping命令测试网络")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nPING "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.053")]),t._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.059")]),t._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.058")]),t._v(" ms\n")])])]),a("p",[t._v("发现可以互联，没有问题。")]),t._v(" "),a("p",[t._v("但是，"),a("strong",[t._v("容器的网络IP其实是一个虚拟的IP，其值并不固定与某一个容器绑定，如果我们在开发时写死某个IP，而在部署时很可能MySQL容器的IP会发生变化，连接会失败。")])]),t._v(" "),a("p",[t._v("所以，我们必须借助于docker的网络功能来解决这个问题（通过自定义一个新的网桥，容器可以在这个新的网桥中通过容器名进行访问，不用ip），官方文档：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/engine/reference/commandline/network/")]),t._v(" "),a("p",[t._v("常见命令有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("命令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("文档地址")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network create")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建一个网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_create/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network create"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network ls")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看所有网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_ls/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network rm")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_rm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network prune")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("清除未使用的网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network connect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("使指定容器连接加入某网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_connect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network disconnect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("使指定容器连接离开某网络")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_disconnect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network disconnect"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("docker network inspect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看网络详细信息")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network inspect"),a("OutboundLink")],1)])])])]),t._v(" "),a("p",[t._v("教学演示：自定义网络")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.首先通过命令创建一个网络")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network create hmall\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后查看网络")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\nNETWORK ID     NAME      DRIVER    SCOPE\n639bc44d0a87   bridge    bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n403f16ec62a2   hmall     bridge    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n0dc0f72a0fbb   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\ncd8d3e8df47b   none      null      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 其中，除了hmall以外，其它都是默认的网络")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.让dd和mysql都加入该网络，注意，在加入网络时可以通过--alias给容器起别名")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这样该网络内的其它容器可以用别名互相访问！")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.1.mysql容器，指定别名为db，另外每一个容器都有一个别名是容器名")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network connect hmall mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--alias")]),t._v(" db\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.2.db容器，也就是我们的java项目")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network connect hmall "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以在容器创建时通过--network 指定网桥连接")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.进入dd容器，尝试利用别名访问db")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.1.进入容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.2.用db别名访问")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" db\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nPING db "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.070")]),t._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.056")]),t._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.3.用容器名访问")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\nPING mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.044")]),t._v(" ms\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.054")]),t._v(" ms\n")])])]),a("p",[a("strong",[t._v("总结")]),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("在自定义网络中，可以给容器起多个别名，默认的别名是容器名本身")]),t._v(" "),a("li",[t._v("在同一个自定义网络中的容器，可以通过别名互相访问")])]),t._v(" "),a("h1",{attrs:{id:"_3-项目部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-项目部署"}},[t._v("#")]),t._v(" 3.项目部署")]),t._v(" "),a("p",[t._v("好了，我们已经熟悉了Docker的基本用法，接下来可以尝试部署项目了。")]),t._v(" "),a("p",[t._v("在课前资料中已经提供了一个黑马商城项目给大家，如图：")]),t._v(" "),a("p",[t._v("项目说明：")]),t._v(" "),a("ul",[a("li",[t._v("hmall：商城的后端代码")]),t._v(" "),a("li",[t._v("hmall-portal：商城用户端的前端代码")]),t._v(" "),a("li",[t._v("hmall-admin：商城管理端的前端代码")])]),t._v(" "),a("p",[t._v("部署的容器及端口说明：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("项目")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("容器名")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("端口")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("备注")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("hmall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("hmall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("8080")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城后端API入口")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("hmall-portal")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("nginx")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("18080")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城用户端入口")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("hmall-admin")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("18081")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城管理端入口")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("mysql")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("mysql")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3306")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据库")])])])]),t._v(" "),a("p",[t._v("在正式部署前，我们先删除之前的nginx、dd两个容器：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\n")])])]),a("p",[t._v("mysql容器中已经准备好了商城的数据，所以就不再删除了。")]),t._v(" "),a("h2",{attrs:{id:"_3-1-部署java项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部署java项目"}},[t._v("#")]),t._v(" 3.1.部署Java项目")]),t._v(" "),a("p",[a("code",[t._v("hmall")]),t._v("项目是一个maven聚合项目，使用IDEA打开"),a("code",[t._v("hmall")]),t._v("项目，查看项目结构如图：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/1737381336013-10.png",alt:"img"}})]),t._v(" "),a("p",[t._v("我们要部署的就是其中的"),a("code",[t._v("hm-service")]),t._v("，其中的配置文件采用了多环境的方式：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/1737381336013-11.png",alt:"img"}})]),t._v(" "),a("p",[t._v("其中的"),a("code",[t._v("application-dev.yaml")]),t._v("是部署到开发环境的配置，"),a("code",[t._v("application-local.yaml")]),t._v("是本地运行时的配置。")]),t._v(" "),a("p",[t._v("查看application.yaml，你会发现其中的JDBC地址并未写死，而是读取变量：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/1737381336013-12.png",alt:"img"}})]),t._v(" "),a("p",[t._v("这两个变量在"),a("code",[t._v("application-dev.yaml")]),t._v("和"),a("code",[t._v("application-local.yaml")]),t._v("中并不相同：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://stofu80ry.sabkt.gdipper.com/picture/1737381336013-13.png",alt:"img"}})]),t._v(" "),a("p",[t._v("在dev开发环境（也就是Docker部署时）采用了mysql作为地址，刚好是我们的mysql容器名，只要两者在一个网络，就一定能互相访问。")]),t._v(" "),a("p",[t._v("我们将项目打包：")]),t._v(" "),a("p",[t._v("将"),a("code",[t._v("hm-service")]),t._v("目录下的"),a("code",[t._v("Dockerfile")]),t._v("和"),a("code",[t._v("hm-service/target")]),t._v("目录下的"),a("code",[t._v("hm-service.jar")]),t._v("一起上传到虚拟机的"),a("code",[t._v("root")]),t._v("目录：")]),t._v(" "),a("p",[t._v("部署项目：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.构建项目镜像，不指定tag，则默认为latest")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" hmall "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.查看镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nhmall         latest    0bb07b2c34b9   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v(" seconds ago   362MB\ndocker-demo   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("       49743484da68   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" hours ago     327MB\nnginx         latest    605c77e624dd   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" months ago    141MB\nmysql         latest    3218b38490ce   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" months ago    516MB\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.创建并运行容器，并通过--network将其加入hmall网络，这样才能通过容器名访问mysql")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" hmall "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 hmall\n")])])]),a("p",[t._v("测试，通过浏览器访问：http://你的虚拟机地址:8080/search/list")]),t._v(" "),a("h2",{attrs:{id:"_3-2-部署前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-部署前端"}},[t._v("#")]),t._v(" 3.2.部署前端")]),t._v(" "),a("p",[a("code",[t._v("hmall-portal")]),t._v("和"),a("code",[t._v("hmall-admin")]),t._v("是前端代码，需要基于nginx部署。在课前资料中已经给大家提供了nginx的部署目录：")]),t._v(" "),a("p",[t._v("其中：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("html")]),t._v("是静态资源目录，我们需要把"),a("code",[t._v("hmall-portal")]),t._v("以及"),a("code",[t._v("hmall-admin")]),t._v("都复制进去")]),t._v(" "),a("li",[a("code",[t._v("nginx.conf")]),t._v("是nginx的配置文件，主要是完成对"),a("code",[t._v("html")]),t._v("下的两个静态资源目录做代理")])]),t._v(" "),a("p",[t._v("我们现在要做的就是把整个nginx目录上传到虚拟机的"),a("code",[t._v("/root")]),t._v("目录下：")]),t._v(" "),a("p",[t._v("然后创建nginx容器并完成两个挂载：")]),t._v(" "),a("ul",[a("li",[t._v("把"),a("code",[t._v("/root/nginx/nginx.conf")]),t._v("挂载到"),a("code",[t._v("/etc/nginx/ng``inx.conf")])]),t._v(" "),a("li",[t._v("把"),a("code",[t._v("/root/nginx/html")]),t._v("挂载到"),a("code",[t._v("/usr/share/nginx/html")])])]),t._v(" "),a("p",[t._v("由于需要让nginx同时代理hmall-portal和hmall-admin两套前端资源，因此我们需要暴露两个端口：")]),t._v(" "),a("ul",[a("li",[t._v("18080：对应hmall-portal")]),t._v(" "),a("li",[t._v("18081：对应hmall-admin")])]),t._v(" "),a("p",[t._v("命令如下：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v(":18080 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18081")]),t._v(":18081 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /root/nginx/html:/usr/share/nginx/html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /root/nginx/nginx.conf:/etc/nginx/nginx.conf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  nginx\n")])])]),a("p",[t._v("测试，通过浏览器访问：http://你的虚拟机ip:18080")]),t._v(" "),a("h2",{attrs:{id:"_3-3-dockercompose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-dockercompose"}},[t._v("#")]),t._v(" 3.3.DockerCompose")]),t._v(" "),a("p",[t._v("大家可以看到，我们部署一个简单的java项目，其中包含3个容器：")]),t._v(" "),a("ul",[a("li",[t._v("MySQL")]),t._v(" "),a("li",[t._v("Nginx")]),t._v(" "),a("li",[t._v("Java项目")])]),t._v(" "),a("p",[t._v("而稍微复杂的项目，其中还会有各种各样的其它中间件，需要部署的东西远不止3个。如果还像之前那样手动的逐一部署，就太麻烦了。")]),t._v(" "),a("p",[t._v("而Docker Compose就可以帮助我们实现"),a("strong",[t._v("多个相互关联的Docker容器的快速部署")]),t._v("。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器。")]),t._v(" "),a("h3",{attrs:{id:"_3-3-1-基本语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-基本语法"}},[t._v("#")]),t._v(" 3.3.1.基本语法")]),t._v(" "),a("p",[t._v("docker-compose.yml文件的基本语法可以参考官方文档：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/compose/compose-file/compose-file-v3/")]),t._v(" "),a("p",[t._v("docker-compose文件中可以定义多个相互关联的应用容器，每一个应用容器被称为一个服务（service）。由于service就是在定义某个应用的运行时参数，因此与"),a("code",[t._v("docker run")]),t._v("参数非常相似。")]),t._v(" "),a("p",[t._v("举例来说，用docker run部署MySQL的命令如下：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/conf:/etc/mysql/conf.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/init:/docker-entrypoint-initdb.d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall\n  mysql\n")])])]),a("p",[t._v("如果用"),a("code",[t._v("docker-compose.yml")]),t._v("文件来定义，就是这样：")]),t._v(" "),a("div",{staticClass:"language-YAML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/conf:/etc/mysql/conf.d"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/data:/var/lib/mysql"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" new\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("new")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n")])])]),a("p",[t._v("对比如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("docker run 参数")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("docker compose 指令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--name")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("container_name")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("容器名称")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-p")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ports")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("端口映射")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-e")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("environment")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("环境变量")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("-v")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("volumes")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据卷配置")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("--network")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("networks")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])])])]),t._v(" "),a("p",[t._v("明白了其中的对应关系，相信编写"),a("code",[t._v("docker-compose")]),t._v("文件应该难不倒大家。")]),t._v(" "),a("p",[t._v("黑马商城部署文件：")]),t._v(" "),a("div",{staticClass:"language-YAML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/conf:/etc/mysql/conf.d"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/data:/var/lib/mysql"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/init:/docker-entrypoint-initdb.d"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hmall")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080:8080"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mysql\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18080:18080"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18081:18081"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./nginx/nginx.conf:/etc/nginx/nginx.conf"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./nginx/html:/usr/share/nginx/html"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hmall\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hm-net")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n")])])]),a("h3",{attrs:{id:"_3-3-2-基础命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-基础命令"}},[t._v("#")]),t._v(" 3.3.2.基础命令")]),t._v(" "),a("p",[t._v("编写好docker-compose.yml文件，就可以部署项目了。常见的命令：")]),t._v(" "),a("p",[t._v("https://docs.docker.com/compose/reference/")]),t._v(" "),a("p",[t._v("基本语法如下：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("COMMAND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("其中，OPTIONS和COMMAND都是可选参数，比较常见的有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("类型")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("参数或指令")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("说明")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Options")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-f")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定compose文件的路径和名称（不指定就是在当前目录）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-p")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定project名称。project就是当前compose文件中设置的多个service的集合，是逻辑概念")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Commands")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("up")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建并启动所有service容器")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("down")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("停止并移除所有容器、网络")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ps")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("列出所有启动的容器")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("logs")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看指定容器的日志")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("stop")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("停止容器")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("start")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("启动容器")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("restart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("重启容器")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("top")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查看运行的进程")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("exec")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("在指定的运行中容器中执行命令")])])])]),t._v(" "),a("p",[t._v("教学演示：")]),t._v(" "),a("div",{staticClass:"language-Bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.进入root目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.删除旧容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.删除hmall镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi hmall\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.清空MySQL数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" mysql/data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.启动所有, -d 参数是后台启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Building "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(".5s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("/8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" FINISHED\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build definition from Dockerfile                                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring dockerfile: 358B                                                    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load .dockerignore                                                       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: 2B                                                         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load metadata "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" docker.io/library/openjdk:11.0-jre-buster             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(".4s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FROM docker.io/library/openjdk:11.0-jre-buster@sha256:3546a17e6fb4ff4fa681c3  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build context                                                       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: 98B                                                        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-snf")]),t._v(" /usr/share/zoneinfo/Asia/Shanghai /etc/localtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY hm-service.jar /app.jar                                           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting to image                                                                  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting layers                                                                 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" writing image sha256:32eebee16acde22550232f2eb80c69d2ce813ed099640e4cfed2193f71  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" naming to docker.io/library/root-hmall                                           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("/4\n ✔ Network hmall    Created                                                             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".2s\n ✔ Container mysql  Started                                                             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".5s\n ✔ Container hmall  Started                                                             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".9s\n ✔ Container nginx  Started                                                             "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".5s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.查看镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose images\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nCONTAINER           REPOSITORY          TAG                 IMAGE ID            SIZE\nhmall               root-hmall          latest              32eebee16acd        362MB\nmysql               mysql               latest              3218b38490ce        516MB\nnginx               nginx               latest              605c77e624dd        141MB\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.查看容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nNAME                IMAGE               COMMAND                  SERVICE             CREATED             STATUS              PORTS\nhmall               root-hmall          "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java -jar /app.jar"')]),t._v("     hmall               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8080-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp, :::8080-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp\nmysql               mysql               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker-entrypoint.s…"')]),t._v("   mysql               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, :::3306-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("33060")]),t._v("/tcp\nnginx               nginx               "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/docker-entrypoint.…"')]),t._v("   nginx               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" seconds       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:18080-18081-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v("-18081/tcp, :::18080-18081-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v("-18081/tcp\n")])])]),a("p",[t._v("打开浏览器，访问：http://yourIp:8080")]),t._v(" "),a("h1",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[t._v("#")]),t._v(" 例子")]),t._v(" "),a("p",[t._v("https://www.bilibili.com/video/BV1S142197x7?spm_id_from=333.788.player.switch&vd_source=5063386180163934afae66c4e87325ac&p=47")])])}),[],!1,null,null,null);a.default=n.exports}}]);